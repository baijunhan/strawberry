package ink.andromeda.strawberry.test;

import ink.andromeda.strawberry.core.DynamicDataSource;
import ink.andromeda.strawberry.core.StrawberryAutoConfiguration;
import ink.andromeda.strawberry.core.StrawberryService;
import ink.andromeda.strawberry.core.VirtualDataSet;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

@RunWith(SpringRunner.class)
@SpringBootTest(classes = StrawberryAutoConfiguration.class)
@Slf4j
public class ContextServiceTest {

    @Autowired
    StrawberryService strawberryService;

    @Autowired
    DynamicDataSource dynamicDataSource;

    @Test
    public void test(){

    }

    @Test
    public void joinQueryTest() throws Exception {

        String sql = "SELECT * FROM master.core_system.core_order co " +
                     "JOIN capital.capital.zfpt_user_repayment_plan zurp ON co.channel_order_no=zurp.channel_order_no AND co.period =zurp.period " +
                     "JOIN mobile_card.mobile_card.mcc_customer_consume mcc ON mcc.sequence_number = zurp.channel_order_no " +
                     "WHERE zurp.channel_order_no IN ('SJ_SD2017092252747504238','SJ_SD2017092260735914153','SJ_SD2017092255860914364','SJ_SD2017092264213496457','SJ_SD2017092229612045680','SJ_SD2017092230030051031','SJ_SD2017092239097100788','SJ_SD2017092261703399094','SJ_SD2017092264363302681','SJ_SD2017092257700391942','SJ_SD2017092257609815640','SJ_SD2017092254171362443','SJ_SD2017092250980215793','SJ_SD2017092262978821513','SJ_SD2017092256021001310','SJ_SD2017092251066317555','SJ_SD2017092256247036475','SJ_SD2017092254373718198','SJ_SD2017092264997140541','SJ_SD2017092254207494009','SJ_SD2017092250079270996','SJ_SD2017092255201989274','SJ_SD2017092259548916091','SJ_SD2017092256157746118','SJ_SD2017092252602276164','SJ_SD2017092229803884268','SJ_SD2017092256301914189','SJ_SD2017092219063786383','SJ_SD2017092240078125358','SJ_SD2017092266837252439','SJ_SD2017092229205015162','SJ_SD2017092265355064833','SJ_SD2017092250478621484','SJ_SD2017092264218273687','SJ_SD2017092251667956338','SJ_SD2017092255707087634','SJ_SD2017092251115640345','SJ_SD2017092255464510970','SJ_SD2017092253358135547','SJ_SD2017092250901916862','SJ_SD2017092266527780155','SJ_SD2017092264942976923','SJ_SD2017092258349957304','SJ_SD2017092265112336772','SJ_SD2017092254138262009','SJ_SD2017092250522617462','SJ_SD2017092265995249547','SJ_SD2017092229425439330','SJ_SD2017092255696151666','SJ_SD2017092239761852884','SJ_SD2017092251036098683','SJ_SD2017092253100195034','SJ_SD2017092255287791345','SJ_SD2017092257796423533','SJ_SD2017092251566722375','SJ_SD2017092216940763399','SJ_SD2017092262475367687','SJ_SD2017092261189310647','SJ_SD2017092250752960008','SJ_SD2017092217340566066','SJ_SD2017092261971229379','SJ_SD2017092230372583396','SJ_SD2017092250601277560','SJ_SD2017092230880573631','SJ_SD2017092250727636417','SJ_SD2017092263273162733','SJ_SD2017092255102748237','SJ_SD2017092251546400962','SJ_SD2017092250578302638','SJ_SD2017092256594515189','SJ_SD2017092250878640511','SJ_SD2017092251101501763','SJ_SD2017092257112947001','SJ_SD2017092257701481633','SJ_SD2017092239443626724','SJ_SD2017092252924475443','SJ_SD2017092263885332131','SJ_SD2017092250741697421','SJ_SD2017092230605276640','SJ_SD2017092250744877420','SJ_SD2017092255439429587','SJ_SD2017092262514435556','SJ_SD2017092231653690592','SJ_SD2017092254293431334','SJ_SD2017092252449024719','SJ_SD2017092265780878546','SJ_SD2017092230946122895','SJ_SD2017092166777845510','SJ_SD2017092259538064841','SJ_SD2017092253830731323','SJ_SD2017092252661862110','SJ_SD2017092252273920383','SJ_SD2017092218008551582','SJ_SD2017092251626623133','SJ_SD2017092230312337693','SJ_SD2017092253546845383','SJ_SD2017092253761764166','SJ_SD2017092256257952038','SJ_SD2017092229690857848','SJ_SD2017092253280163592','SJ_SD2017092251385462932','SJ_SD2017092240412693017','SJ_SD2017092267376143148','SJ_SD2017092263756835191','SJ_SD2017092261790287787','SJ_SD2017092255964321315','SJ_SD2017092251388401575','SJ_SD2017092218354955268','SJ_SD2017092254320554696','SJ_SD2017092254559678622','SJ_SD2017092266718356685','SJ_SD2017092263884265417','SJ_SD2017092219005038643','SJ_SD2017092258672235237','SJ_SD2017092254415894547','SJ_SD2017092219159135390','SJ_SD2017092251504626912','SJ_SD2017092252594923594','SJ_SD2017092258776670719','SJ_SD2017092255818282723','SJ_SD2017092251568378668','SJ_SD2017092260164693044','SJ_SD2017092218404528682','SJ_SD2017092217000718444','SJ_SD2017092238864939379','SJ_SD2017092254137956404','SJ_SD2017092264637369158','SJ_SD2017092264804269352','SJ_SD2017092259306371532','SJ_SD2017092257397002123','SJ_SD2017092250693537025','SJ_SD2017092250792317856','SJ_SD2017092251461606274','SJ_SD2017092255758571257','SJ_SD2017092264127324624','SJ_SD2017092250318305342','SJ_SD2017092253733148887','SJ_SD2017092260840262556','SJ_SD2017092250870278155','SJ_SD2017092257402247616','SJ_SD2017092264413400046','SJ_SD2017092254563936684','SJ_SD2017092251108125493','SJ_SD2017092253721042570','SJ_SD2017092239336969194','SJ_SD2017092250748886319','SJ_SD2017092219005942554','SJ_SD2017092255643515647','SJ_SD2017092257270904809','SJ_SD2017092260077631404','SJ_SD2017092231241439100','SJ_SD2017092262571186068','SJ_SD2017092250589330851','SJ_SD2017092259599724471','SJ_SD2017092263816954268','SJ_SD2017092251335315057','SJ_SD2017092219279718256','SJ_SD2017092254951844977','SJ_SD2017092256580812148','SJ_SD2017092251134397928','SJ_SD2017092251302367175','SJ_SD2017092261626151296','SJ_SD2017092254067757010','SJ_SD2017092263272219045','SJ_SD2017092251189865668','SJ_SD2017092252846403589','SJ_SD2017092256476243959','SJ_SD2017092253945200127','SJ_SD2017092215826702925','SJ_SD2017092259376454196','SJ_SD2017092250828449427','SJ_SD2017092250082073352','SJ_SD2017092239276481189','SJ_SD2017092254102233051','SJ_SD2017092252327789413','SJ_SD2017092253367232625','SJ_SD2017092253960037501','SJ_SD2017092252471327182','SJ_SD2017092240344641830','SJ_SD2017092251151873420','SJ_SD2017092249591390446','SJ_SD2017092218548984976','SJ_SD2017092253329946161','SJ_SD2017092251731054998','SJ_SD2017092256083808827','SJ_SD2017092230474384946','SJ_SD2017092221721656112','SJ_SD2017092262405148407','SJ_SD2017092231492479768','SJ_SD2017092252394602017','SJ_SD2017092252007794612','SJ_SD2017092251611890587','SJ_SD2017092249667285416','SJ_SD2017092250712097007','SJ_SD2017092256394085840','SJ_SD2017092251860170789','SJ_SD2017092231425882448','SJ_SD2017092230543638263','SJ_SD2017092251019106273','SJ_SD2017092254715569939','SJ_SD2017092218223914450','SJ_SD2017092260932704400','SJ_SD2017092253150460724','SJ_SD2017092258685140727','SJ_SD2017092264883221833','SJ_SD2017092255869327612','SJ_SD2017092257177563419','SJ_SD2017092251780943592','SJ_SD2017092258071355539','SJ_SD2017092251784167445','SJ_SD2017092253974795987','SJ_SD2017092250779806490','SJ_SD2017092252506761839','SJ_SD2017092266889447180','SJ_SD2017092264640744976','SJ_SD2017092216191327903','SJ_SD2017092259683073583','SJ_SD2017092252988948888','SJ_SD2017092263668707608','SJ_SD2017092251410853233','SJ_SD2017092252182558220','SJ_SD2017092253727718256','SJ_SD2017092262485597005','SJ_SD2017092216067316832','SJ_SD2017092264598309857') AND mcc.repayment_status=2";
        VirtualDataSet virtualDataSet = new VirtualDataSet(0, "ss", null, null);

        virtualDataSet.setDataSourceMap(dynamicDataSource.getIncludedDataSource());

        virtualDataSet.executeQuery(sql);
    }

}
